---
phase: 03-workflow-integration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/gsd/discuss-phase.md
autonomous: true

must_haves:
  truths:
    - "discuss-phase command loads user docs at discussion start"
    - "User docs inform discussion but don't override user answers"
    - "Missing USER-CONTEXT.md causes silent continue (no error)"
    - "Potential conflicts between user docs and user answers are noted"
  artifacts:
    - path: "commands/gsd/discuss-phase.md"
      provides: "User doc loading in discussion workflow"
      contains: "USER-CONTEXT.md"
  key_links:
    - from: "commands/gsd/discuss-phase.md"
      to: ".planning/codebase/USER-CONTEXT.md"
      via: "load at discussion start"
      pattern: "USER-CONTEXT.md"
---

<objective>
Integrate validated user documentation into the discussion workflow.

Purpose: Enable discuss-phase to reference user-provided documentation when gathering phase context through conversation. This fulfills WFL-03 (discuss-phase uses user docs) and contributes to WFL-04 (smart selection).

Output: Modified discuss-phase.md command that loads USER-CONTEXT.md and uses it to inform discussion while checking for conflicts with user answers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-workflow-integration/03-CONTEXT.md
@.planning/phases/03-workflow-integration/03-RESEARCH.md

# Files to modify
@commands/gsd/discuss-phase.md

# Reference
@agents/gsd-doc-ingestor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add user doc loading to discuss-phase.md</name>
  <files>commands/gsd/discuss-phase.md</files>
  <action>
Modify discuss-phase.md to load USER-CONTEXT.md at discussion start and use it to inform the conversation.

Add new section after `<context>`:

```markdown
<user_documentation>
## User-Provided Documentation

**Location:** `.planning/codebase/USER-CONTEXT.md`

**Loading:** At discussion start, check for and load relevant user documentation.

\`\`\`bash
if [ -f ".planning/codebase/USER-CONTEXT.md" ]; then
  cat .planning/codebase/USER-CONTEXT.md
fi
\`\`\`

**If exists:**
- Extract sections relevant to current phase (via keyword matching on phase name + goal)
- Use as background context when analyzing gray areas
- Reference when asking questions ("Your docs mention X - does that still apply?")
- Note potential conflicts if user answers contradict their docs

**If missing:**
- Silent continue (no error, no suggestion to run map-codebase)
- Proceed with discussion normally

**Relevance selection by phase type:**

| Phase Keywords | Load Categories |
|----------------|-----------------|
| UI, frontend | reference, general |
| API, backend | api, architecture |
| database, schema | architecture |
| testing | reference, setup |
| setup, config | setup, reference |
| integration | api, architecture, setup |

**Conflict handling:**
When user answer contradicts their documentation:
- Note the discrepancy naturally: "Your docs describe X, but you mentioned Y - should the docs be updated, or has this changed?"
- User's current answer takes precedence (docs may be stale)
- No blocking or error - just gentle surfacing
</user_documentation>
```

Update the `<process>` section. After step 1 (Validate phase number), add:

```markdown
1.5. **Load user documentation (if available)**

   Check for USER-CONTEXT.md:
   \`\`\`bash
   if [ -f ".planning/codebase/USER-CONTEXT.md" ]; then
     echo "User docs found - loading relevant sections"
   fi
   \`\`\`

   **If exists:** Load sections relevant to phase. Use as background context.
   **If missing:** Silent continue - proceed without user docs.
```

Update the step 5 (Deep-dive each area) to mention using user docs:

Add to the bullet points:
```markdown
- Reference user docs when relevant ("Your architecture doc mentions...")
- Note if user answer differs from their docs (gentle conflict surfacing)
```
  </action>
  <verify>
Read commands/gsd/discuss-phase.md and confirm:
1. New `<user_documentation>` section exists
2. Process includes step 1.5 for loading user docs
3. Category mapping table present
4. Conflict handling documented (gentle surfacing, user answer precedence)
5. Deep-dive step references user docs
6. Silent continue when missing
  </verify>
  <done>discuss-phase.md loads USER-CONTEXT.md at start and uses it to inform discussion, noting conflicts gently</done>
</task>

<task type="auto">
  <name>Task 2: Update gray area analysis to consider user docs</name>
  <files>commands/gsd/discuss-phase.md</files>
  <action>
Enhance the gray area identification in discuss-phase.md to consider user documentation.

In the `<process>` section, update step 3 (Analyze phase):

After "Generate 3-4 **phase-specific** gray areas, not generic categories." add:

```markdown
**User docs integration in gray area analysis:**

If USER-CONTEXT.md was loaded:
- Check if user docs already answer some gray areas (reduce question count)
- Identify areas where user docs are unclear or potentially stale (prioritize these)
- Reference specific doc content when framing questions

Example adjustments:
- User docs specify "REST API with JSON" → don't ask about API format
- User docs unclear on auth approach → prioritize auth in gray areas
- User docs mention "Phase 1 uses X" → verify if still current
```

Add to the success criteria:

```markdown
- User docs considered when identifying gray areas (if available)
```
  </action>
  <verify>
Read commands/gsd/discuss-phase.md and confirm:
1. Step 3 (Analyze phase) mentions user docs integration
2. Examples show how user docs reduce/inform gray areas
3. Success criteria includes user docs consideration
  </verify>
  <done>discuss-phase.md considers user documentation when identifying gray areas, reducing redundant questions</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **File modifications verified:**
   - commands/gsd/discuss-phase.md has user_documentation section
   - Process includes user doc loading step
   - Gray area analysis considers user docs

2. **Conflict handling correct:**
   - Conflicts noted gently, not blocked
   - User answer takes precedence over docs
   - No aggressive "your docs are wrong" messages

3. **No breaking changes:**
   - Discussion works without USER-CONTEXT.md
   - Existing flow preserved
</verification>

<success_criteria>
- [ ] discuss-phase.md loads USER-CONTEXT.md at discussion start
- [ ] Relevance selection via category mapping
- [ ] Conflict handling documented (gentle, user answer precedence)
- [ ] Gray area analysis considers existing user docs
- [ ] Missing USER-CONTEXT.md causes silent continue (no errors)
</success_criteria>

<output>
After completion, create `.planning/phases/03-workflow-integration/03-03-SUMMARY.md`
</output>
