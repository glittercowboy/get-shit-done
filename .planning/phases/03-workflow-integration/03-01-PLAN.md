---
phase: 03-workflow-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/gsd/plan-phase.md
  - agents/gsd-phase-researcher.md
  - agents/gsd-planner.md
autonomous: true

must_haves:
  truths:
    - "plan-phase command can reference user docs when planning"
    - "gsd-phase-researcher has access to relevant user documentation"
    - "gsd-planner receives user context for informed planning"
    - "Missing USER-CONTEXT.md causes silent continue (no error)"
  artifacts:
    - path: "commands/gsd/plan-phase.md"
      provides: "User doc loading step in planning workflow"
      contains: "USER-CONTEXT.md"
    - path: "agents/gsd-phase-researcher.md"
      provides: "User doc consumption in research"
      contains: "user-provided-docs"
    - path: "agents/gsd-planner.md"
      provides: "User doc consumption in planning"
      contains: "user-provided-docs"
  key_links:
    - from: "commands/gsd/plan-phase.md"
      to: ".planning/codebase/USER-CONTEXT.md"
      via: "file existence check before spawning agents"
      pattern: "USER-CONTEXT.md"
    - from: "agents/gsd-planner.md"
      to: "user docs"
      via: "context block in prompt"
      pattern: "<user-provided-docs>"
---

<objective>
Integrate validated user documentation into the planning workflow.

Purpose: Enable gsd-phase-researcher and gsd-planner to access relevant user-provided documentation when researching and planning phases. This fulfills WFL-01 and contributes to WFL-04 (smart selection).

Output: Modified plan-phase.md command and gsd-phase-researcher.md/gsd-planner.md agents that load and use USER-CONTEXT.md when available.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-workflow-integration/03-CONTEXT.md
@.planning/phases/03-workflow-integration/03-RESEARCH.md

# Files to modify
@commands/gsd/plan-phase.md
@agents/gsd-phase-researcher.md
@agents/gsd-planner.md

# Reference - existing user doc loading pattern
@agents/gsd-doc-ingestor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add user doc loading to plan-phase.md</name>
  <files>commands/gsd/plan-phase.md</files>
  <action>
Modify plan-phase.md to check for and include USER-CONTEXT.md when spawning researcher and planner agents.

Add a new step between step 7 (Gather Context Paths) and step 8 (Spawn gsd-planner):

```markdown
## 7.5. Load User Documentation (if available)

Check for user-provided documentation:

\`\`\`bash
USER_DOCS_PATH=".planning/codebase/USER-CONTEXT.md"
if [ -f "$USER_DOCS_PATH" ]; then
  echo "USER_DOCS_AVAILABLE"
else
  echo "NO_USER_DOCS"
fi
\`\`\`

**If USER-CONTEXT.md exists:**
- Include in context paths for both researcher and planner
- Do NOT announce to user (transparent loading)

**If USER-CONTEXT.md does NOT exist:**
- Silent continue (no error, no suggestion to run map-codebase)
- Proceed without user docs
```

Update the researcher spawn prompt (step 5) to include user docs reference:

```markdown
**User documentation (if available):**
@.planning/codebase/USER-CONTEXT.md
```

Update the planner spawn prompt (step 8) to include:

```markdown
**User documentation (if available):**
@.planning/codebase/USER-CONTEXT.md
```

The @-reference pattern means the file is only included if it exists.
  </action>
  <verify>
Read commands/gsd/plan-phase.md and confirm:
1. New step 7.5 exists for user doc loading check
2. Researcher spawn prompt includes USER-CONTEXT.md reference
3. Planner spawn prompt includes USER-CONTEXT.md reference
4. No error messages or suggestions when USER-CONTEXT.md missing
  </verify>
  <done>plan-phase.md checks for USER-CONTEXT.md and passes it to both researcher and planner agents when available</done>
</task>

<task type="auto">
  <name>Task 2: Update gsd-phase-researcher to use user docs</name>
  <files>agents/gsd-phase-researcher.md</files>
  <action>
Modify gsd-phase-researcher.md to load and use user documentation when available.

Add new section after `<upstream_input>`:

```markdown
<user_documentation>
## User-Provided Documentation

**Location:** `.planning/codebase/USER-CONTEXT.md`

**Loading protocol:**
1. Check if file exists (silent continue if not)
2. Extract sections relevant to phase domain via keyword matching
3. Present relevant content in `<user-provided-docs>` block
4. Include confidence levels from validation metadata

**Relevance selection:**
Match phase name + goal keywords against USER-CONTEXT.md categories:

| Phase Keywords | Primary Categories |
|----------------|-------------------|
| UI, frontend, components | reference, general |
| API, backend, endpoints | api, architecture |
| database, schema, models | architecture |
| testing, tests | reference, setup |
| setup, config | setup, reference |
| integration | api, architecture, setup |

**Usage in research:**
- Cross-reference user claims against findings
- Note agreements/disagreements between user docs and official sources
- Weight user docs as MEDIUM confidence (user-provided, may be stale)

**If no USER-CONTEXT.md:** Silent continue - user docs are optional.
</user_documentation>
```

Update execution flow step 1 to include user doc loading:

After "Load phase context (MANDATORY):" add:

```markdown
**Load user documentation (OPTIONAL):**

\`\`\`bash
if [ -f ".planning/codebase/USER-CONTEXT.md" ]; then
  cat .planning/codebase/USER-CONTEXT.md
fi
\`\`\`

**If exists:** Include relevant sections as context for research. Cross-reference user claims with official sources.

**If missing:** Silent continue - proceed without user documentation.
```
  </action>
  <verify>
Read agents/gsd-phase-researcher.md and confirm:
1. New `<user_documentation>` section exists
2. Execution flow step 1 includes user doc loading
3. Category mapping table for relevance selection
4. Silent continue behavior when file missing
  </verify>
  <done>gsd-phase-researcher loads USER-CONTEXT.md when available and uses relevant sections during research</done>
</task>

<task type="auto">
  <name>Task 3: Update gsd-planner to use user docs</name>
  <files>agents/gsd-planner.md</files>
  <action>
Modify gsd-planner.md to load and use user documentation when available.

Add new section after `<discovery_levels>`:

```markdown
<user_documentation>
## User-Provided Documentation

**Location:** `.planning/codebase/USER-CONTEXT.md`

**Loading protocol:**
1. Check if file exists (silent continue if not)
2. Extract sections relevant to phase via keyword matching
3. Include in planning context as `<user-provided-docs>` block
4. Pass through confidence levels (HIGH/MEDIUM/LOW)

**Relevance selection:**
Match phase name + goal keywords against USER-CONTEXT.md categories:

| Phase Keywords | Primary Categories |
|----------------|-------------------|
| UI, frontend, components | reference, general |
| API, backend, endpoints | api, architecture |
| database, schema, models | architecture |
| testing, tests | reference, setup |
| setup, config | setup, reference |
| integration | api, architecture, setup |

**Usage in planning:**
- Reference user docs when deriving must_haves
- Consider user-documented patterns when specifying tasks
- Weight by confidence: HIGH = facts, MEDIUM = guidance, LOW = verify

**Format in plan context:**

\`\`\`markdown
<user-provided-docs>
## [Category]

### [document-name.md]
**Confidence:** [HIGH/MEDIUM/LOW]

[Content...]
</user-provided-docs>
\`\`\`

**If no USER-CONTEXT.md:** Silent continue - user docs are optional.
</user_documentation>
```

Update `<execution_flow>` step `load_codebase_context`:

After "If exists, load relevant documents based on phase type:" add:

```markdown
**Load user documentation (if available):**

\`\`\`bash
if [ -f ".planning/codebase/USER-CONTEXT.md" ]; then
  # File exists - load for planning context
  echo "User docs available - loading relevant sections"
fi
```

**If USER-CONTEXT.md exists:**
- Extract sections matching phase keywords
- Include in planning context
- Silent loading (no user messages)

**If missing:** Silent continue.
```
  </action>
  <verify>
Read agents/gsd-planner.md and confirm:
1. New `<user_documentation>` section exists
2. Execution flow includes user doc loading step
3. Category mapping table matches researcher
4. Format specification for `<user-provided-docs>` block
5. Silent continue when file missing
  </verify>
  <done>gsd-planner loads USER-CONTEXT.md when available and incorporates into planning context</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **File modifications verified:**
   - commands/gsd/plan-phase.md has user doc loading step
   - agents/gsd-phase-researcher.md has user_documentation section
   - agents/gsd-planner.md has user_documentation section

2. **Consistency check:**
   - Category mapping identical across researcher and planner
   - Silent continue behavior consistent
   - Confidence level handling documented

3. **No breaking changes:**
   - Existing plan-phase workflow unchanged when no USER-CONTEXT.md
   - No new required files or dependencies
</verification>

<success_criteria>
- [ ] plan-phase.md includes USER-CONTEXT.md in agent spawn contexts
- [ ] gsd-phase-researcher.md can load and use user docs
- [ ] gsd-planner.md can load and use user docs
- [ ] Missing USER-CONTEXT.md causes silent continue (no errors)
- [ ] Category mapping enables smart selection (WFL-04)
- [ ] Confidence levels passed through to planning context
</success_criteria>

<output>
After completion, create `.planning/phases/03-workflow-integration/03-01-SUMMARY.md`
</output>
