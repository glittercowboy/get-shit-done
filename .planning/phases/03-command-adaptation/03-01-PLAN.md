---
phase: 03-command-adaptation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [.opencode/agent/gsd/execute-plan.md, .opencode/agent/gsd/explore.md, .opencode/agent/gsd/plan.md]
autonomous: false
---

<objective>
Create OpenCode agent definitions and verify command execution compatibility.

Purpose: Ensure GSD commands work identically on OpenCode by creating necessary agent definitions and testing command execution patterns.
Output: OpenCode agent definitions for key GSD workflows, verified command execution on OpenCode platform.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/claude/opencode-mapping.md
@.planning/phases/02-multi-agent-installer/SUMMARY.md
@bin/install.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OpenCode agent definitions for core workflows</name>
  <files>.opencode/agent/gsd/execute-plan.md, .opencode/agent/gsd/explore.md, .opencode/agent/gsd/plan.md</files>
  <action>
    Create OpenCode agent definitions for the three main GSD subagent patterns identified in Phase 1 research:

    1. **execute-plan agent** (.opencode/agent/gsd/execute-plan.md):
       - mode: subagent
       - model: claude-sonnet-4-20250514
       - edit: allow
       - bash: allow
       - webfetch: deny
       - Body: @~/.config/opencode/gsd/workflows/execute-plan.md
       - Description: "Execute a single plan with full context"

    2. **explore agent** (.opencode/agent/gsd/explore.md):
       - mode: subagent
       - model: claude-sonnet-4-20250514
       - edit: deny
       - bash: allow (for grep, find)
       - webfetch: deny
       - Body: Reference to Explore subagent behavior from Claude Code
       - Description: "Fast codebase exploration and analysis"

    3. **plan agent** (.opencode/agent/gsd/plan.md):
       - mode: subagent
       - model: claude-sonnet-4-20250514
       - edit: deny (read-only during planning)
       - bash: allow (for ls, cat, git commands)
       - webfetch: allow (for research)
       - Body: Reference to Plan subagent behavior from Claude Code
       - Description: "Design implementation plans for phases"

    Use YAML frontmatter format from opencode-mapping.md. Include @-references to corresponding workflow files.
  </action>
  <verify>
    - All three agent files exist in .opencode/agent/gsd/
    - Each has valid YAML frontmatter with description, mode, model, permissions
    - Agent bodies reference corresponding workflow files via @-syntax
  </verify>
  <done>OpenCode can load and execute these agents as subagents</done>
</task>

<task type="auto">
  <name>Task 2: Test command installation and basic execution</name>
  <files>N/A - testing task</files>
  <action>
    Test the OpenCode installation flow:

    1. Run installer in test mode:
       ```bash
       node bin/install.js --platform opencode --local --dry-run
       ```

    2. Verify transformation output:
       - Check that .opencode/command/gsd/*.md files would be created
       - Spot-check 3-4 commands for correct frontmatter (no `name`, `argument-hint`, `allowed-tools`)
       - Verify path substitution (all @-refs use .opencode/ and ~/.config/opencode/)

    3. Check agent file generation:
       - Verify .opencode/agent/gsd/ directory would be created
       - Confirm all three agent definitions present

    4. Inspect transformed command structure:
       - Read a complex command (execute-phase, plan-phase) after transformation
       - Verify @-references resolve correctly
       - Check $ARGUMENTS usage is intact
       - Confirm XML structure preserved

    Document any issues found in verification checklist below.
  </action>
  <verify>
    - Installation completes without errors
    - Transformed commands have correct frontmatter (description only)
    - All @-references use OpenCode paths
    - $ARGUMENTS syntax preserved
    - Agent definitions generated correctly
  </verify>
  <done>Installer successfully creates OpenCode-compatible command structure</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>OpenCode agent definitions and installation transformation verified in dry-run mode</what-built>
  <how-to-verify>
    I need you to test the actual OpenCode installation and command execution:

    1. **Install to OpenCode** (if you have OpenCode available):
       ```bash
       node bin/install.js --platform opencode --local
       ```

    2. **Verify file structure**:
       ```bash
       ls .opencode/command/gsd/
       ls .opencode/agent/gsd/
       cat .opencode/command/gsd/new-project.md  # Check frontmatter
       ```

    3. **Test basic command** (if OpenCode is configured):
       - Try running `/gsd:help` or equivalent OpenCode command syntax
       - Verify command loads without YAML errors
       - Check that @-references resolve correctly

    4. **Report findings**:
       - Does installation succeed?
       - Are frontmatter fields correctly transformed?
       - Do commands load in OpenCode?
       - Any YAML parsing errors?
       - Any path resolution issues?

    **If you don't have OpenCode installed:** Just verify the file structure and frontmatter transformation look correct in the installed files.
  </how-to-verify>
  <resume-signal>Type "approved" if installation looks correct, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Three OpenCode agent definitions created
- [ ] Agent frontmatter follows OpenCode schema
- [ ] Agent bodies reference workflow files correctly
- [ ] Dry-run installation shows correct transformation
- [ ] User verified installation structure (or confirmed unavailable to test)
</verification>

<success_criteria>
- All tasks completed
- OpenCode agent definitions exist with correct permissions
- Installation transformation verified (dry-run or actual)
- No YAML parsing errors reported
- Command structure compatible with OpenCode conventions
- User confirmation of installation correctness
</success_criteria>

<output>
After completion, create `.planning/phases/03-command-adaptation/03-01-SUMMARY.md`
</output>
