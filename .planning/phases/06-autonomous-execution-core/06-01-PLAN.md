---
phase: 06-autonomous-execution-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/bin/roadmap-parser.js
  - get-shit-done/bin/gsd-tools.js
autonomous: true

must_haves:
  truths:
    - "Roadmap parsing extracts all phase metadata from ROADMAP.md"
    - "DAG builder produces topological execution order"
    - "Circular dependencies are detected and reported"
    - "Phase dependencies are enforced in execution order"
  artifacts:
    - path: "get-shit-done/bin/roadmap-parser.js"
      provides: "Roadmap parsing and DAG building"
      exports: ["parseRoadmap", "buildDAG", "getExecutionOrder"]
      min_lines: 100
  key_links:
    - from: "get-shit-done/bin/gsd-tools.js"
      to: "get-shit-done/bin/roadmap-parser.js"
      via: "require statement"
      pattern: "require\\('./roadmap-parser"
    - from: "roadmap-parser.js"
      to: ".planning/ROADMAP.md"
      via: "file read"
      pattern: "readFileSync.*ROADMAP.md"
---

<objective>
Create ROADMAP.md parser and DAG-based execution order calculator.

Purpose: Enable autonomous roadmap execution by parsing phase structure and computing dependency-aware execution order.
Output: roadmap-parser.js module with parseRoadmap(), buildDAG(), getExecutionOrder() functions integrated into gsd-tools.
</objective>

<execution_context>
@/Users/ollorin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ollorin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-autonomous-execution-core/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create roadmap parser module</name>
  <files>get-shit-done/bin/roadmap-parser.js</files>
  <action>
Create roadmap-parser.js with:

1. **parseRoadmap(roadmapPath)** - Parse ROADMAP.md into structured phases array:
   - Use readline interface with fs.createReadStream for line-by-line parsing
   - Extract from each phase: number, name, goal, depends_on[], requirements[], success_criteria[], status, plans_count
   - Handle "### Phase N: Name" headers
   - Parse "**Goal**:", "**Depends on**:", "**Requirements**:", "**Plans:**" fields
   - Parse Success Criteria numbered lists (indented, start with digit)
   - Handle "Nothing (first phase)" and "Nothing (parallel)" as empty depends_on
   - Return: { phases: Phase[], total: number, roadmap_path: string }

2. **buildDAG(phases)** - Build adjacency list from dependencies:
   - Create Map of phase number -> depends_on numbers
   - Create inDegree Map for topological sort
   - Detect cycles using visited set during sort
   - Return: { graph: Map, inDegree: Map }

3. **getExecutionOrder(phases)** - Kahn's algorithm for topological sort:
   - Initialize queue with phases where inDegree === 0
   - Process queue: pop, add to result, decrement dependents' inDegree
   - If dependent inDegree hits 0, add to queue
   - After processing: if result.length !== phases.length → circular dependency error
   - Return: { execution_order: number[], has_cycle: boolean, cycle_phases?: number[] }

4. **detectParallelOpportunities(graph, order)** - Group phases that can run parallel:
   - For each phase in order: find phases with no mutual dependencies
   - Group into parallel batches
   - Return: number[][] (batches of parallel phase numbers)

Module exports: { parseRoadmap, buildDAG, getExecutionOrder, detectParallelOpportunities }

Handle edge cases:
- Missing ROADMAP.md → return { error: "ROADMAP.md not found" }
- Malformed phase headers → skip with warning
- Empty depends_on (first phase) → inDegree 0
  </action>
  <verify>
```bash
# Verify module exists and exports functions
node -e "const r = require('./get-shit-done/bin/roadmap-parser.js'); console.log(Object.keys(r))"
# Should output: [ 'parseRoadmap', 'buildDAG', 'getExecutionOrder', 'detectParallelOpportunities' ]

# Test parsing actual ROADMAP.md
node -e "const r = require('./get-shit-done/bin/roadmap-parser.js'); r.parseRoadmap('.planning/ROADMAP.md').then(p => console.log('Phases:', p.total))"
```
  </verify>
  <done>roadmap-parser.js exists with parseRoadmap, buildDAG, getExecutionOrder, detectParallelOpportunities functions</done>
</task>

<task type="auto">
  <name>Task 2: Integrate roadmap commands into gsd-tools</name>
  <files>get-shit-done/bin/gsd-tools.js</files>
  <action>
Add roadmap subcommands to gsd-tools.js:

1. **roadmap parse** - Parse and display roadmap structure:
   ```bash
   node gsd-tools.js roadmap parse
   ```
   Output JSON: { phases: [...], total: N, roadmap_path: "..." }

2. **roadmap dag** - Build and display execution graph:
   ```bash
   node gsd-tools.js roadmap dag
   ```
   Output JSON: { execution_order: [...], parallel_opportunities: [...], has_cycle: false }

3. **roadmap status [phase]** - Get phase status (pending/in_progress/complete):
   - If phase arg: return status for that phase
   - If no arg: return all phases with statuses
   - Check for VERIFICATION.md with status: passed for completion

4. **roadmap validate** - Validate roadmap structure:
   - All phases have Goal
   - Dependencies reference valid phases
   - No circular dependencies
   - Requirements IDs are valid format
   - Output: { valid: true/false, errors: [...], warnings: [...] }

Add require statement at top:
```javascript
const { parseRoadmap, buildDAG, getExecutionOrder, detectParallelOpportunities } = require('./roadmap-parser.js');
```

Add case handler for 'roadmap' command with subcommands.
  </action>
  <verify>
```bash
# Test roadmap parse
node /Users/ollorin/.claude/get-shit-done/bin/gsd-tools.js roadmap parse | head -20

# Test roadmap dag
node /Users/ollorin/.claude/get-shit-done/bin/gsd-tools.js roadmap dag | head -10

# Test roadmap validate
node /Users/ollorin/.claude/get-shit-done/bin/gsd-tools.js roadmap validate
```
  </verify>
  <done>gsd-tools.js responds to "roadmap parse", "roadmap dag", "roadmap status", "roadmap validate" commands</done>
</task>

<task type="auto">
  <name>Task 3: Add execution order verification</name>
  <files>get-shit-done/bin/roadmap-parser.js</files>
  <action>
Add verification functions to roadmap-parser.js:

1. **verifyDependenciesMet(phases, targetPhase)** - Check if phase can execute:
   - Get depends_on for target phase
   - For each dependency: check if phase status is "complete"
   - Return: { can_execute: boolean, blocking: number[], ready: number[] }

2. **getNextExecutablePhases(phases)** - Find all phases that can start:
   - Filter phases where status !== "complete"
   - For each: check verifyDependenciesMet
   - Return phases where can_execute === true
   - Return: { executable: number[], blocked: { phase: number, waiting_on: number[] }[] }

3. **validatePhaseCompletion(phaseNumber)** - Verify phase actually complete:
   - Check VERIFICATION.md exists in phase directory
   - Check status field is "passed"
   - Check all plans have SUMMARY.md
   - Return: { complete: boolean, missing: string[] }

Update module exports to include new functions.

These functions enable the coordinator to:
- Know which phase to execute next
- Block on incomplete dependencies
- Verify completion before unlocking dependents
  </action>
  <verify>
```bash
# Verify new exports
node -e "const r = require('./get-shit-done/bin/roadmap-parser.js'); console.log(Object.keys(r))"
# Should include: verifyDependenciesMet, getNextExecutablePhases, validatePhaseCompletion

# Test dependency verification
node -e "const r = require('./get-shit-done/bin/roadmap-parser.js'); r.parseRoadmap('.planning/ROADMAP.md').then(p => console.log(r.getNextExecutablePhases(p.phases)))"
```
  </verify>
  <done>roadmap-parser.js includes verifyDependenciesMet, getNextExecutablePhases, validatePhaseCompletion functions</done>
</task>

</tasks>

<verification>
- roadmap-parser.js exists in get-shit-done/bin/
- All 7 functions exported: parseRoadmap, buildDAG, getExecutionOrder, detectParallelOpportunities, verifyDependenciesMet, getNextExecutablePhases, validatePhaseCompletion
- gsd-tools.js responds to "roadmap" command with subcommands
- Parsing actual ROADMAP.md produces correct phase count (8)
- DAG execution order respects dependencies (Phase 6 after 1, 2, 5)
</verification>

<success_criteria>
- Roadmap parsing works with current ROADMAP.md format
- Execution order correctly reflects dependency chain
- Circular dependency detection works
- CLI commands integrated into gsd-tools
</success_criteria>

<output>
After completion, create `.planning/phases/06-autonomous-execution-core/06-01-SUMMARY.md`
</output>
